/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

/* 
 * File:   Sampling.h
 * Author: jnortiz
 *
 * Created on October 30, 2017, 2:55 PM
 */

#include <inttypes.h>
#include <stdlib.h>

#ifndef SAMPLING_H
#define SAMPLING_H

#define ROWS 128
#define COLS 40

class Sampling {
public:
    Sampling();
    Sampling(const Sampling& orig);
    virtual ~Sampling();
    int32_t knuth_yao_ct_fast_32(int tailcut, int sigma, int center);    
private:    
    int rows;
    int cols;
    int randomBits[ROWS];
    const uint32_t _p32_t[ROWS] =
{0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 5, 14, 6, 28, 48, 11, 91, 21, 151, 29, 115, 261, 356, 1022, 0, 1979,
649, 662, 2533, 394, 3885, 4422, 6621, 3717, 10085, 14247, 2087, 32191, 31092, 5293, 64733, 6382, 39056, 115692, 51969, 5856, 94298,
171399, 177506, 92944, 508031, 82593, 227864, 25774, 1030068, 7848, 1028490, 420956, 1371527, 764718, 1483754, 1713010, 3014121,
52865, 3832607, 959009, 6586417, 2413379, 1330906, 8187911, 6557106, 9169590, 10590036, 14973908, 14290999, 19921632, 11609504,
18523933, 25695147, 9724218, 47622715, 60536693, 42918720, 16785990, 105485922, 6837708, 50755763, 43186108, 94426434, 226108042,
19905797, 44150882, 187467745, 109279605, 422163790, 172043920, 255161468, 426425504, 264698303, 905612549, 52289274, 62428384,
426638585, 325949524, 652487048, 1482215515, 1224550981, 303419361, 1867463484, 51807019, 3683469341u, 803931803, 1714099899,
2620837769u, 2169546439u, 1709320247, 3824357929u, 4067003105u, 2706660263u, 724038919, 2747761453u, 2899911731u, 2781772224u,
2289919236u, 2637396209u, 3220823603u, 540201915, 3813240143u};

    const uint8_t _p8_t[ROWS] =
{0, 0, 0, 15, 54, 90, 150, 96, 152, 230, 226, 90, 4, 82, 222, 246, 14, 64, 162, 196, 47, 149, 166, 58,
7, 232, 174, 161, 204, 62, 4, 2, 139, 138, 90, 123, 195, 227, 11, 86, 88, 118, 8, 60, 224, 18, 245, 103, 194, 158, 239, 182, 126,
63, 83, 207, 61, 2, 253, 162, 5, 125, 9, 113, 252, 95, 136, 54, 159, 35, 171, 33, 128, 130, 11, 190, 117, 98, 186, 86, 178, 19,
64, 237, 192, 250, 223, 28, 125, 71, 21, 199, 187, 163, 6, 98, 155, 140, 244, 204, 77, 60, 200, 147, 1, 185, 34, 110, 181, 39, 175,
182, 171, 116, 171, 201, 196, 125, 55, 117, 48, 197, 231, 50, 71, 0, 92, 100};

    const uint8_t _hw[ROWS] =
{0, 0, 0, 4, 4, 4, 4, 3, 4, 6, 6, 7, 3, 6, 8, 9, 8, 4, 8, 7, 10, 7, 8, 13, 3, 13, 9, 8, 11, 9, 9, 6, 13, 9, 12, 16, 9, 18, 12,
  11, 15, 13, 6, 14, 9, 8, 14, 15, 12, 12, 19, 11, 15, 14, 18, 13, 16, 11, 19, 15, 14, 16, 18, 11, 21, 14, 9, 14, 17, 15, 15, 16,
12, 16, 14, 21, 14, 16, 16, 14, 19, 21, 12, 12, 14, 17, 20, 19, 17, 17, 17, 15, 20, 19, 17, 13, 22, 17, 26, 20, 22, 16, 23, 18,
13, 19, 17, 20, 25, 16, 22, 23, 22, 21, 18, 19, 19, 22, 21, 22, 18, 19, 22, 16, 22, 23, 19, 21};
    
    int32_t Select(int32_t a, int32_t b, unsigned bit);
    static uint32_t ct_lt_u32(uint32_t x, uint32_t y);
    
};

#endif /* SAMPLING_H */

